// pages/EvaluationForm/EvaluationForm1.js
const app = getApp();
var globalData = app.globalData;
var domain = globalData.host;
Page({
  data: {
    index: '',//    
    pics: false,
    result: ['','','',''],
    arraylife: ['毫无影响', '有轻微影响', '有相当程度影响', '有十分严重的影响', '有极度影响，几乎病痛不欲生'],
    imageArray: ['/pages/image/level0.jpg', '/pages/image/level1.jpg', '/pages/image/level2.jpg', '/pages/image/level3.jpg', '/pages/image/level4.jpg'],
    imageList: [
      ['0.jpg', '1.jpg', '2.jpg', '3.jpg', '4.jpg', '5.jpg', '6.jpg', '7.jpg'],
      ['hb1.png', 'hb2.png', 'hb3.png', 'hb4.png', 'hb5.png'],
      ['tx1.png', 'tx2.png', 'tx3.png', 'tx4.png', 'tx5.png'],
      ['jr1.png', 'jr2.png', 'jr3.png', 'jr4.png', 'jr5.png'],
    ],
    imageBox:[],//需要展示的列表
    level: '',
    lifePic:"",
    tipsMsg: ["请选择面积", "请选择红斑", "请选择鳞屑","请选择厚度"],
    show: false,
    warnmsg: ''
  },
  prompt: function (msg) {
    this.setData({
      show: true,
      warnmsg: msg
    })
    var that = this;
    setTimeout(function () {
      that.setData({
        show: false,
        warnmsg: ""
      })
    }, 1500);
  },
  showpics: function (e) {
    var index = e.currentTarget.dataset.index;
    this.setData({
      pics: true,
      index:index,
      imageBox:this.data.imageList[index]
    })    
  },
  choosePic: function (e) {    
    var val = e.currentTarget.dataset.index;   
    var index = this.data.index;   
    var result = 'result[' + index + ']';
    
    this.setData({
      [result]:val,
      pics: false
    });
    console.log(this.data)
    globalData.data.result1[index] = val;
    
  },

  bindPickerlife: function (e) {
    var val = e.detail.value;    
    app.globalData.data.level = val;
    // console.log(this.data.imageArray[e.detail.value])
    this.setData({
      lifePic: this.data.imageArray[val],
      level: val
    })

  },
  
  formSubmit: function () {
    var result = this.data.result;
    for (let i = 0; i < result.length; i++) {
      if (result[i]===''){
        this.prompt(this.data.tipsMsg[i]);
        return;
      }
    };
    if (this.data.level==''){
      this.prompt('请选择生活质量评分！');
      return;
    }    
    console.log('没有表单错误，允许跳转');
    wx.navigateTo({
      url: '/pages/pages/evaluation/form3'
    })    
  },
  /**
   * 生命周期函数--监听页面加载
   */
  onLoad: function (options) {
    var life_level = globalData.data.level;
    this.setData({
      result: globalData.data.result1,
      level: life_level,
    });
    if (life_level!=''){
      this.setData({
        lifePic: this.data.imageArray[globalData.data.level],
      });
    }      
  },
  /**
   * 生命周期函数--监听页面初次渲染完成
   */
  onReady: function () {

  },

  /**
   * 生命周期函数--监听页面显示
   */
  onShow: function () {
    
    console.log(this.data)
  },

  /**
   * 生命周期函数--监听页面隐藏
   */
  onHide: function () {

  },

  /**
   * 生命周期函数--监听页面卸载
   */
  onUnload: function () {
    this.setData({
      pics: [false, false, false, false]
    });
  },

  /**
   * 页面相关事件处理函数--监听用户下拉动作
   */
  onPullDownRefresh: function () {

  },

  /**
   * 页面上拉触底事件的处理函数
   */
  onReachBottom: function () {

  },

  /**
   * 用户点击右上角分享
   */
  onShareAppMessage: function () {

  }
})