var app = getApp();
var domain = app.globalData.host;
Page({
  data: {
    imgheight: 150,
    nickName: '您的昵称',
    headImg: 'http://pic.tsing-tec.com/eplus/images/a2805c15b6c84b17a21c886e6a6c3441.png',
    headImgHeight: '190rpx',
    topMargin: '80rpx',
    show: false,
    arrayeducation: ['文盲', '小学', '初中', '高中', '大学', '研究生以上'],
    information: app.globalData.information
  },
  prompt: function (msg) {
    this.setData({
      show: true,
      warnmsg: msg
    })
    var that = this;
    setTimeout(function () {
      that.setData({
        show: false,
        warnmsg: ""
      })
    }, 1500);
  },
  onLoad: function () {
    console.log(domain)
    console.log("doctor-index.js----onload");
    var width = wx.getSystemInfoSync().windowWidth;
    console.log(width);
    var userInfo = app.globalData.userInfo;
    var doctor = app.globalData.doctor;
    console.log(doctor)
    this.setData({
      imgheight: width * 0.64,
      nickName: doctor ? (doctor.name ? doctor.name : userInfo.nickname) ? doctor.name : userInfo.nickname: "您的昵称",
      headImg: userInfo.headimgurl ? userInfo.headimgurl : "http://pic.tsing-tec.com/eplus/images/a2805c15b6c84b17a21c886e6a6c3441.png",
      headImgHeight: width * 0.24,
      topMargin: width * 0.12,
      des: doctor.description ? doctor.description : "暂未填写个人简介",
    })
  },
  info: function () {
    wx.navigateTo({
      url: '/pages/pages/doctor/info'
    })
  },
  my_patient: function () {
    wx.navigateTo({
      url: '/pages/pages/doctor/patient'
    })
  },
  my_list: function () {
    wx.navigateTo({
      url: '/pages/pages/doctor/list?ifEnd=0'
    })
  },
  scan: function () {
    
    var unionid = app.globalData.unionid;
    // 允许从相机和相册扫码
    wx.scanCode({
      success: (res) => {
        var result = res.result;
        console.log(result)
        var token = result;
        console.log(token)
        wx.request({
          url: domain + `/wxs/doctor/bind?unionid=${unionid}&token=${token}`,
          method: "GET",
          contentType: 'application/json;charset=UTF-8',
          header: {
            'content-type': 'application/json'
          },
          success: function (result) {
            console.log(result.data)
            if (result.data.errcode == 0) {
              var result = JSON.stringify(result.data.data);
              wx.navigateTo({
                url: '/pages/pages/details?result=' + result,
              })
            } else if (result.data.errcode == -1) {
              wx.showModal({
                title: '提示',
                content: result.data.errmsg,
                showCancel: false,
                success(res) {
                  if (res.confirm) {
                    console.log('用户点击确定')
                  }
                }
              })
            }

          }
        })
      }
    })
  },
})